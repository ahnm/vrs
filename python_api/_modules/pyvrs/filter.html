
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pyvrs.filter &#8212; pyvrs  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pyvrs  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pyvrs.filter</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pyvrs.filter</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># Copyright (c) Meta Platforms, Inc. and affiliates.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">from</span> <span class="nn">bisect</span> <span class="kn">import</span> <span class="n">bisect</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ImageConversion</span><span class="p">,</span> <span class="n">RecordType</span>

<span class="kn">from</span> <span class="nn">.base</span> <span class="kn">import</span> <span class="n">BaseVRSReader</span>
<span class="kn">from</span> <span class="nn">.record</span> <span class="kn">import</span> <span class="n">VRSRecord</span>
<span class="kn">from</span> <span class="nn">.slice</span> <span class="kn">import</span> <span class="n">VRSReaderSlice</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_recordable_type_id_name</span><span class="p">,</span>
    <span class="n">string_of_set</span><span class="p">,</span>
    <span class="n">tags_to_justified_table_str</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;FilteredVRSReader&quot;</span><span class="p">,</span>
    <span class="s2">&quot;SyncFilteredVRSReader&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RecordFilter&quot;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="RecordFilter"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.RecordFilter">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RecordFilter</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;RecordFilter represents a filter that&#39;s applied to the VRS file.&quot;&quot;&quot;</span>

    <span class="n">record_types</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">stream_ids</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">min_timestamp</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">max_timestamp</span><span class="p">:</span> <span class="nb">float</span></div>


<div class="viewcode-block" id="FilteredVRSReader"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader">[docs]</a><span class="k">class</span> <span class="nc">FilteredVRSReader</span><span class="p">(</span><span class="n">BaseVRSReader</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;FilteredVRSReader represents subset of VRSReader after applying filter.</span>
<span class="sd">    This class essentially has the exact same methods as VRSReader but operates against subset of the file.</span>
<span class="sd">    Note that you can&#39;t `re-filter` an already filtered VRSReader.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">:</span> <span class="n">BaseVRSReader</span><span class="p">,</span> <span class="n">record_filter</span><span class="p">:</span> <span class="n">RecordFilter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            reader: reader object for the whole VRS file (i.e. without any filters)</span>
<span class="sd">            record_fitler: filter that&#39;s applied to the VRS file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_record_filter</span> <span class="o">=</span> <span class="n">record_filter</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_filtered_indices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_min_timestamp</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">get_timestamp_for_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_timestamp</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">get_timestamp_for_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">VRSRecord</span><span class="p">,</span> <span class="n">VRSReaderSlice</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_records</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dict of all file tags present in this VRS file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary of all file tags: {&lt;tag&gt;: &lt;value&gt;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">file_tags</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stream_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dict of all file tags present in this VRS file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary of all file tags: {&lt;tag&gt;: &lt;value&gt;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">stream_tags</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">n_records</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The number of records that this reader is configured to read, given current filters.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">record_types</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The set of record types that this reader is configured to read, given current</span>
<span class="sd">        filters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_filter</span><span class="o">.</span><span class="n">record_types</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">stream_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;The set of stream ids that this reader is configured to read, given current</span>
<span class="sd">        filters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_filter</span><span class="o">.</span><span class="n">stream_ids</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">min_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The timestamp for the first record that this reader is configured to read, given current filters.</span>
<span class="sd">        Return 0 if there are no record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_timestamp</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The timestamp for the last record that this reader is configured to read, given current filters.</span>
<span class="sd">        Return 0 if there are no record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_timestamp</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">min_filter_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The value of min_timestamp when user called filter method on VRSReader.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_filter</span><span class="o">.</span><span class="n">min_timestamp</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_filter_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;The value of max_timestamp when user called filter method on VRSReader.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_record_filter</span><span class="o">.</span><span class="n">max_timestamp</span>

<div class="viewcode-block" id="FilteredVRSReader.find_stream"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.find_stream">[docs]</a>    <span class="k">def</span> <span class="nf">find_stream</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">recordable_type_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tag_value</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find stream matching recordable type and tag, and return its stream id.</span>
<span class="sd">        This call isn&#39;t affected by the filter.</span>

<span class="sd">        Args:</span>
<span class="sd">            recordable_type_id: stream_id is `&lt;recordable_type_id&gt;-&lt;instance_id&gt;`</span>
<span class="sd">            tag_name: tag name that you are interested in</span>
<span class="sd">            tag_value: tag value that you are interested in</span>

<span class="sd">        Returns:</span>
<span class="sd">            Stream ID that starts with recordable_type_id and has a given tag pair.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">find_stream</span><span class="p">(</span><span class="n">recordable_type_id</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">,</span> <span class="n">tag_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.find_streams"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.find_streams">[docs]</a>    <span class="k">def</span> <span class="nf">find_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recordable_type_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">flavor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find streams matching recordable type and flavor, and return sets of stream ids.</span>
<span class="sd">        This call isn&#39;t affected by the filter.</span>

<span class="sd">        Args:</span>
<span class="sd">            recordable_type_id: stream_id is `&lt;recordable_type_id&gt;-&lt;instance_id&gt;`</span>
<span class="sd">            tag_name: tag name that you are interested in</span>
<span class="sd">            tag_value: tag value that you are interested in</span>

<span class="sd">        Returns:</span>
<span class="sd">            A set of stream IDs that start with recordable_type_id and has a given flavor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">find_streams</span><span class="p">(</span><span class="n">recordable_type_id</span><span class="p">,</span> <span class="n">flavor</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.get_stream_info"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.get_stream_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_stream_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get details about a stream.</span>

<span class="sd">        Args:</span>
<span class="sd">            stream_id: stream_id you are interested in.</span>

<span class="sd">        Returns:</span>
<span class="sd">            An information about the stream in a dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">get_stream_info</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.get_records_count"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.get_records_count">[docs]</a>    <span class="k">def</span> <span class="nf">get_records_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record_type</span><span class="p">:</span> <span class="n">RecordType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the number of records for the stream_id &amp; record_type.</span>

<span class="sd">        Args:</span>
<span class="sd">            stream_id: stream_id you are interested in.</span>
<span class="sd">            record_type: record type you are interested in.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The number of records for stream_id &amp; record type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">get_records_count</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">record_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.get_timestamp_list"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.get_timestamp_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_timestamp_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the list of timestamps corresponding to the given indices.</span>

<span class="sd">        Args:</span>
<span class="sd">            indices: the list of indices we want to get the timestamp.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A list of timestamps correspond to the indices, if indices are None, we get the full timestamp list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">get_timestamp_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.get_timestamp_for_index"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.get_timestamp_for_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_timestamp_for_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the timestamp corresponding to the given index.</span>

<span class="sd">        Args:</span>
<span class="sd">            index: the index for the record</span>

<span class="sd">        Returns:</span>
<span class="sd">            A timestamp corresponds to the index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Index </span><span class="si">{}</span><span class="s2"> is out of range.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">get_timestamp_for_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">[</span><span class="n">index</span><span class="p">])</span></div>

<div class="viewcode-block" id="FilteredVRSReader.set_image_conversion"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.set_image_conversion">[docs]</a>    <span class="k">def</span> <span class="nf">set_image_conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conversion</span><span class="p">:</span> <span class="n">ImageConversion</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set default image conversion policy, and clears any stream specific setting.</span>

<span class="sd">        Args:</span>
<span class="sd">            conversion: The image conversion you want to apply for all streams.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;This should be called in SyncVRSReader before applying filter.&quot;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.set_stream_image_conversion"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.set_stream_image_conversion">[docs]</a>    <span class="k">def</span> <span class="nf">set_stream_image_conversion</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversion</span><span class="p">:</span> <span class="n">ImageConversion</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set image conversion policy for a specific stream.</span>

<span class="sd">        Args:</span>
<span class="sd">            stream_id: The stream_id you want to apply image conversion to.</span>
<span class="sd">            conversion: The image conversion you want to apply for a specific stream.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;This should be called in SyncVRSReader before applying filter.&quot;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.set_stream_type_image_conversion"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.set_stream_type_image_conversion">[docs]</a>    <span class="k">def</span> <span class="nf">set_stream_type_image_conversion</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">recordable_type_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conversion</span><span class="p">:</span> <span class="n">ImageConversion</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set image conversion policy for streams of a specific device type.</span>

<span class="sd">        Args:</span>
<span class="sd">            recordable_type_id: The recordable_type_id you want to apply image conversion to.</span>
<span class="sd">                                If you specify 1000, streams with id 1000-* are the targets.</span>
<span class="sd">            conversion: The image conversion you want to apply for a specific stream.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The number of streams affected.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;This should be called in SyncVRSReader before applying filter.&quot;</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.might_contain_images"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.might_contain_images">[docs]</a>    <span class="k">def</span> <span class="nf">might_contain_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the given stream_id contains an image data.</span>

<span class="sd">        Args:</span>
<span class="sd">            stream_id: stream_id that you are interested in.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Based on the config record, return if the stream contains an image data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">might_contain_images</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.might_contain_audio"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.might_contain_audio">[docs]</a>    <span class="k">def</span> <span class="nf">might_contain_audio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the given stream_id contains an audio data.</span>

<span class="sd">        Args:</span>
<span class="sd">            stream_id: stream_id that you are interested in.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Based on the config record, return if the stream contains an audio data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">might_contain_audio</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.get_estimated_frame_rate"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.get_estimated_frame_rate">[docs]</a>    <span class="k">def</span> <span class="nf">get_estimated_frame_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the estimated frame rate for the given stream_id.</span>

<span class="sd">        Args:</span>
<span class="sd">            stream_id: stream_id that you are interested in.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The estimated frame rate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">get_estimated_frame_rate</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.get_record_index_by_time"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.get_record_index_by_time">[docs]</a>    <span class="k">def</span> <span class="nf">get_record_index_by_time</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get index in filtered records by timestamp.</span>

<span class="sd">        Args:</span>
<span class="sd">            stream_id: stream_id that you are interested in.</span>
<span class="sd">            timestamp: timestamp that you are interested in.</span>
<span class="sd">            epsilon: Optional argument. If specified we search for record in range of</span>
<span class="sd">               (timestamp-epsilon)-(timestamp+epsilon) and returns the nearest record.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_ids</span>

        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">get_record_index_by_time</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>

        <span class="c1"># TODO: Fix this logic</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">bisect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.read_record_by_time"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.read_record_by_time">[docs]</a>    <span class="k">def</span> <span class="nf">read_record_by_time</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">VRSRecord</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read record by timestamp.</span>

<span class="sd">        Args:</span>
<span class="sd">            stream_id: stream_id that you are interested in.</span>
<span class="sd">            timestamp: timestamp that you are interested in.</span>
<span class="sd">            epsilon: Optional argument. If specified we search for record in range of</span>
<span class="sd">               (timestamp-epsilon)-(timestamp+epsilon) and returns the nearest record.</span>

<span class="sd">        Returns:</span>
<span class="sd">            VRSRecord corresponds to the stream_id &amp; timestamp.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TimestampNotFoundError: If epsilon is not None and the record doesn&#39;t exist within the time range.</span>
<span class="sd">            ValueError: If epsilon is None and the record isn&#39;t found using lower_bound.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">read_record_by_time</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.read_prev_record"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.read_prev_record">[docs]</a>    <span class="k">def</span> <span class="nf">read_prev_record</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VRSRecord</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the last record that matches stream_id and record_type and its index is smaller or equal than given index.</span>

<span class="sd">        Args:</span>
<span class="sd">            stream_id: stream_id that you are interested in.</span>
<span class="sd">            record_type: record_type that you are interested in.</span>
<span class="sd">            index: the absolute index in the file. Based on this index, try to find the previous record that matches stream_id &amp; record_type</span>

<span class="sd">        Returns:</span>
<span class="sd">            VRSRecord if there is a record, otherwise None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index_in_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">read_prev_record</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">record_type</span><span class="p">,</span> <span class="n">index_in_all</span><span class="p">)</span></div>

<div class="viewcode-block" id="FilteredVRSReader.read_next_record"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.FilteredVRSReader.read_next_record">[docs]</a>    <span class="k">def</span> <span class="nf">read_next_record</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">record_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VRSRecord</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the first record that matches stream_id and record_type and its index is greater or equal than given index.</span>

<span class="sd">        Args:</span>
<span class="sd">            stream_id: stream_id that you are interested in.</span>
<span class="sd">            record_type: record_type that you are interested in.</span>
<span class="sd">            index: the absolute index in the file. Based on this index, try to find the previous record that matches stream_id &amp; record_type</span>

<span class="sd">        Returns:</span>
<span class="sd">            VRSRecord if there is a record, otherwise None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index_in_all</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">read_next_record</span><span class="p">(</span><span class="n">stream_id</span><span class="p">,</span> <span class="n">record_type</span><span class="p">,</span> <span class="n">index_in_all</span><span class="p">)</span></div>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">_read_record</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">i</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">VRSRecord</span><span class="p">,</span> <span class="n">VRSReaderSlice</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_record_count_by_type_from_stream_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_record_count_by_type_from_stream_id</span><span class="p">(</span><span class="n">stream_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_filtered_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_generate_filtered_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_record_filter</span><span class="p">)</span></div>


<div class="viewcode-block" id="SyncFilteredVRSReader"><a class="viewcode-back" href="../../modules/filter.html#pyvrs.filter.SyncFilteredVRSReader">[docs]</a><span class="k">class</span> <span class="nc">SyncFilteredVRSReader</span><span class="p">(</span><span class="n">FilteredVRSReader</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Synchrnous version of FilteredVRSReader.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">VRSRecord</span><span class="p">,</span> <span class="n">VRSReaderSlice</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;SyncFilteredVRSReader(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_path</span><span class="si">!r}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;auto_read_configuration_records=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_auto_read_configuration_records</span><span class="si">!r}</span><span class="s2">)&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;filter=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_record_filter</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span>
                <span class="n">tags_to_justified_table_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_tags</span><span class="p">),</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="p">)</span><span class="si">}</span><span class="s2"> records are enabled (based on filters)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Automatic configuration record reading is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s2">&quot;enabled&quot;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_auto_read_configuration_records</span>
                    <span class="k">else</span> <span class="s2">&quot;disabled&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;Available Stream IDs: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">string_of_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">stream_ids</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;  Enabled Stream IDs: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string_of_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_ids</span><span class="p">)),</span>
                <span class="s2">&quot;Available Record Types: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">string_of_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">record_types</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;  Enabled Record Types: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string_of_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">record_types</span><span class="p">)),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">s of available records: </span><span class="si">{:.2f}</span><span class="s2">s - </span><span class="si">{:.2f}</span><span class="s2">s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">time_range</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">min_timestamp</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">max_timestamp</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">s of enabled records: </span><span class="si">{:.2f}</span><span class="s2">s - </span><span class="si">{:.2f}</span><span class="s2">s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">time_range</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">min_timestamp</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_timestamp</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Available Streams in VRS: </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_ids</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;  Stream ID: </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2"> no. </span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">      No. of records </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">stream_id</span><span class="p">,</span>
                <span class="n">get_recordable_type_id_name</span><span class="p">(</span><span class="n">stream_id</span><span class="p">),</span>
                <span class="n">stream_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_record_count_by_type_from_stream_id</span><span class="p">(</span><span class="n">stream_id</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">_read_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">i</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">]):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_read_record</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">AsyncFilteredVRSReader</span><span class="p">(</span><span class="n">FilteredVRSReader</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">:</span> <span class="n">BaseVRSReader</span><span class="p">,</span> <span class="n">record_filter</span><span class="p">:</span> <span class="n">RecordFilter</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">record_filter</span><span class="p">)</span>

        <span class="n">_async_read_record_op</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="p">,</span> <span class="s2">&quot;_async_read_record&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">_async_read_record_op</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;AsyncFilteredVRSReader._reader doesn&#39;t have method _async_read_record.&quot;</span>
                <span class="s2">&quot; You should only construct AsyncFilteredVRSReader via AsyncVRSReader.filtered_by_fields method.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__aiter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__anext__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">StopAsyncIteration</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">VRSRecord</span><span class="p">,</span> <span class="n">VRSReaderSlice</span><span class="p">]:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_async_read_record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filtered_indices</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;AsyncFilteredVRSReader(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_path</span><span class="si">!r}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;auto_read_configuration_records=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_auto_read_configuration_records</span><span class="si">!r}</span><span class="s2">)&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;filter=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_record_filter</span><span class="si">!r}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span>
                <span class="n">tags_to_justified_table_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_tags</span><span class="p">),</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="p">)</span><span class="si">}</span><span class="s2"> records are enabled (based on filters)&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Automatic configuration record reading is </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="s2">&quot;enabled&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_auto_read_configuration_records</span> <span class="k">else</span> <span class="s2">&quot;disabled&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;Available Stream IDs: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">string_of_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">stream_ids</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;  Enabled Stream IDs: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string_of_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stream_ids</span><span class="p">)),</span>
                <span class="s2">&quot;Available Record Types: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">string_of_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">record_types</span><span class="p">)</span>
                <span class="p">),</span>
                <span class="s2">&quot;  Enabled Record Types: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">string_of_set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">record_types</span><span class="p">)),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">s of available records: </span><span class="si">{:.2f}</span><span class="s2">s - </span><span class="si">{:.2f}</span><span class="s2">s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">time_range</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">min_timestamp</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_reader</span><span class="o">.</span><span class="n">max_timestamp</span><span class="p">,</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">s of enabled records: </span><span class="si">{:.2f}</span><span class="s2">s - </span><span class="si">{:.2f}</span><span class="s2">s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">time_range</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">min_timestamp</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_timestamp</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Available Streams in VRS: </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">stream_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_ids</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">+=</span> <span class="s2">&quot;  Stream ID: </span><span class="si">{}</span><span class="s2"> (</span><span class="si">{}</span><span class="s2"> no. </span><span class="si">{}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">      No. of records </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">stream_id</span><span class="p">,</span>
                <span class="n">get_recordable_type_id_name</span><span class="p">(</span><span class="n">stream_id</span><span class="p">),</span>
                <span class="n">stream_id</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_record_count_by_type_from_stream_id</span><span class="p">(</span><span class="n">stream_id</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

    <span class="k">def</span> <span class="nf">_read_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">i</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pyvrs  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pyvrs.filter</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Meta Reality Labs Research.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.2.3.
    </div>
  </body>
</html>